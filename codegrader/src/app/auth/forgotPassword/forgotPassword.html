<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
/>

<div class="stage">
  <div class="blob blob-tl" aria-hidden="true"></div>
  <div class="blob blob-bl" aria-hidden="true"></div>

  <div class="container">
    <!-- div welcome -->
    <div class="section1">
      <div class="mb-3">
        <h1>No Worries !!!</h1>
      </div>

      <div class="p-0 me-0">
        <button (click)="$event.preventDefault(); takemeback()">
          <b>Back to Login</b>
        </button>
        <b>------------------------------------------------</b>
      </div>
    </div>

    <div class="section2">
      <div class="flexcolumn">
        <h2>Forgor Password ?</h2>
        <div class="subtitle">Please enter your email !</div>

        <form (ngSubmit)="onRequestOtp()" autocomplete="off">
          <input
            type="email"
            name="email"
            placeholder="Email"
            required
            [ngModel]="email()"
            (ngModelChange)="email.set($event)"
          />

          <button type="submit" class="btn" [disabled]="isLoading()">
            {{ isLoading() ? 'Loading...' : 'Reset Password' }}
          </button>

          <p class="signup">
            Don't have an account ? <a href="#" (click)="onSignUp($event)">Sign up</a>
          </p>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- OTP Modal -->
<div class="modal fade" id="otpModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">
      <div class="modal-header">
        <h5 class="modal-title">Xác thực OTP</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>
          Mã OTP đã được gửi tới email: <b>{{ email() }}</b>
        </p>

        <input
          type="text"
          class="form-control mb-3"
          placeholder="Nhập OTP"
          [ngModel]="otp()"
          (ngModelChange)="otp.set($event)"
          name="otp"
          required
          #otpInput="ngModel"
        />
        @if(otpInput.invalid && otpInput.touched) {
        <div class="error-message">
          <span>OTP is required</span>
        </div>
        }

        <div class="password-wrapper mb-2">
          <input
            [type]="showPassword() ? 'text' : 'password'"
            class="password-input"
            placeholder="Mật khẩu mới"
            [ngModel]="newPassword()"
            (ngModelChange)="newPassword.set($event)"
            name="newPassword"
            minlength="6"
            required
            #passwordInput="ngModel"
          />
          <button type="button" class="toggle-eye" (click)="togglePassword()">
            <i [class]="showPassword() ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
          </button>
        </div>
        @if(passwordInput.invalid && passwordInput.touched) {
        <div class="error-message">
          @if(passwordInput.errors?.['required']) {
          <span>Password is required</span>
          } @if(passwordInput.errors?.['minlength']) {
          <span>Password must be at least 6 characters</span>
          }
        </div>
        }

        <!-- Password strength -->
        <div class="password-strength">
          <div class="strength-bar">
            <div
              class="strength-segment"
              [class.none]="passwordStrength() === 0"
              [class.weak]="passwordStrength() === 1"
            ></div>
            <div
              class="strength-segment"
              [class.medium]="passwordStrength() == 2 || passwordStrength() == 3"
            ></div>
            <div class="strength-segment" [class.strong]="passwordStrength() == 4"></div>
          </div>

          <div
            class="strength-text"
            [class.none]="passwordStrength() === 0"
            [class.weak]="passwordStrength() === 1"
            [class.medium]="passwordStrength() === 3 || passwordStrength() === 2"
            [class.strong]="passwordStrength() === 4"
          >
            {{ passwordStrengthText() }}
          </div>
        </div>

         <!-- Confirm password -->
          <div class="password-wrapper">
            <input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              name="confirmPassword"
              placeholder="Confirm Password"
              class="password-input"
              required
              [ngModel]="confirmPassword()"
              (ngModelChange)="confirmPassword.set($event)"
              #confirmPasswordInput="ngModel"
            />
            <button type="button" class="toggle-eye" (click)="toggleConfirmPassword()">
              <i [class]="showConfirmPassword() ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
            </button>
          </div>
          @if(confirmPasswordInput.invalid && confirmPasswordInput.touched) {
            <div class="error-message">
              @if(confirmPasswordInput.errors?.['required']) {
                <span>Confirm password is required</span>
              }
            </div>
          }
          @if(confirmPassword() && newPassword() !== confirmPassword()) {
            <div class="error-message">
              <span>Passwords do not match</span>
            </div>
          }

      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button 
          class="btn btn-primary" 
          (click)="onConfirmOtp()"
          [disabled]="!isFormValid()"
        >
          Xác nhận
        </button>
      </div>
    </div>
  </div>
</div>
