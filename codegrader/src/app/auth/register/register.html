<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
/>

<div class="stage">
  <div class="blob blob-tl" aria-hidden="true"></div>
  <div class="blob blob-bl" aria-hidden="true"></div>

  <div class="container">
    <!-- div welcome -->
    <div class="section1">
      <div class="mb-3">
        <h1>Welcome To<br />Code Grader !</h1>
      </div>

      <div class="p-0 me-0">
        <button (click)="$event.preventDefault(); onSkipSignUp()">
          <b>Skip Sign Up ?</b>
        </button>
        <b>----------------------------------------------</b>
      </div>
    </div>

    <div class="section2">
      <div class="flexcolumn">
        <h2>Signup</h2>
        <div class="subtitle">Just some details to get you in.!</div>

        <form (ngSubmit)="onSignup()" autocomplete="off" #signupForm="ngForm">
          <!-- Fullname -->
          <input
            type="text"
            name="fullname"
            placeholder="Fullname"
            required
            minlength="3"
            maxlength="50"
            pattern="[a-zA-Z\s]+"
            [ngModel]="fullname()"
            (ngModelChange)="fullname.set($event)"
            #fullnameInput="ngModel"
          />
          @if(fullnameInput.invalid && fullnameInput.touched) {
            <div class="error-message">
              @if(fullnameInput.errors?.['required']) {
                <span>Fullname is required</span>
              }
              @if(fullnameInput.errors?.['minlength']) {
                <span>Fullname must be at least 3 - 50 characters</span>
              }
              @if(fullnameInput.errors?.['pattern']) {
                <span>Fullname can only contain letters and spaces</span>
              }
            </div>
          }

          <!-- Email -->
          <input
            type="email"
            name="email"
            placeholder="Email"
            required
            email
            [ngModel]="email()"
            (ngModelChange)="email.set($event)"
            #emailInput="ngModel"
          />
          @if(emailInput.invalid && emailInput.touched) {
            <div class="error-message">
              @if(emailInput.errors?.['required']) {
                <span>Email is required</span>
              }
              @if(emailInput.errors?.['email']) {
                <span>Please enter a valid email address</span>
              }
            </div>
          }

          <!-- Username -->
          <input
            type="text"
            name="username"
            placeholder="Username"
            required
            minlength="3"
            maxlength="20"
            pattern="[a-zA-Z0-9_]+"
            [ngModel]="username()"
            (ngModelChange)="username.set($event)"
            #usernameInput="ngModel"
          />
          @if(usernameInput.invalid && usernameInput.touched) {
            <div class="error-message">
              @if(usernameInput.errors?.['required']) {
                <span>Username is required</span>
              }
              @if(usernameInput.errors?.['minlength']) {
                <span>Username must be at least 3 characters</span>
              }
              @if(usernameInput.errors?.['pattern']) {
                <span>Username can only contain letters, numbers</span>
              }
            </div>
          }

          <!-- Password -->
          <div class="password-wrapper">
            <input
              [type]="showPassword() ? 'text' : 'password'"
              name="password"
              placeholder="Password"
              class="password-input"
              required
              minlength="8"
              [ngModel]="password()"
              (ngModelChange)="onPasswordChange($event)"
              #passwordInput="ngModel"
            />
            <button type="button" class="toggle-eye" (click)="togglePassword()">
              <i [class]="showPassword() ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
            </button>
          </div>
          @if(passwordInput.invalid && passwordInput.touched) {
            <div class="error-message">
              @if(passwordInput.errors?.['required']) {
                <span>Password is required</span>
              }
              @if(passwordInput.errors?.['minlength']) {
                <span>Password must be at least 6 characters</span>
              }
            </div>
          }

          <!-- Password strength -->
          <div class="password-strength">
            <div class="strength-bar">
              <div
                class="strength-segment"
                [class.none]="passwordStrength() === 0"
                [class.weak]="passwordStrength() === 1"
              ></div>
              <div
                class="strength-segment"
                [class.medium]="passwordStrength() == 2 || passwordStrength() == 3"
              ></div>
              <div class="strength-segment" [class.strong]="passwordStrength() == 4"></div>
            </div>

            <div
              class="strength-text"
              [class.none]="passwordStrength() === 0"
              [class.weak]="passwordStrength() === 1"
              [class.medium]="passwordStrength() === 3 || passwordStrength() === 2"
              [class.strong]="passwordStrength() === 4"
            >
              {{ passwordStrengthText() }}
            </div>
          </div>

          <!-- Confirm password -->
          <div class="password-wrapper">
            <input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              name="confirmPassword"
              placeholder="Confirm Password"
              class="password-input"
              required
              [ngModel]="confirmPassword()"
              (ngModelChange)="confirmPassword.set($event)"
              #confirmPasswordInput="ngModel"
            />
            <button type="button" class="toggle-eye" (click)="toggleConfirmPassword()">
              <i [class]="showConfirmPassword() ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
            </button>
          </div>
          @if(confirmPasswordInput.invalid && confirmPasswordInput.touched) {
            <div class="error-message">
              @if(confirmPasswordInput.errors?.['required']) {
                <span>Confirm password is required</span>
              }
            </div>
          }
          @if(confirmPassword() && password() !== confirmPassword()) {
            <div class="error-message">
              <span>Passwords do not match</span>
            </div>
          }

          <!-- Submit -->
          <button type="submit" class="btn" [disabled]="isLoading()">
            {{ isLoading() ? 'Loading...' : 'Signup' }}
          </button>

          <!-- Or -->
          <div class="or"><span></span><em>Or</em><span></span></div>

          <!-- Google -->
          <button
            type="button"
            class="google"
            (click)="onGoogleSignup()"
            aria-label="Google signup"
          >
            <img src="https://www.svgrepo.com/show/355037/google.svg" alt="Google" />
          </button>

          <!-- Login link -->
          <p class="login-link">
            Already Registered?
            <a href="#" (click)="onLogin($event)">Login</a>
          </p>
        </form>
      </div>
    </div>
  </div>
</div>
