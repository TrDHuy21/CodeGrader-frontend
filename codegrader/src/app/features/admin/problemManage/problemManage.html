<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

<div class="container">
    <admin-sidebar [activeRoute]="'/manageproblem'" (navItemClick)="onNavItemClick($event)"></admin-sidebar>

    <!-- Content -->
    <div class="section2">
        <!-- Top navbar -->
        <admin-navbar searchPlaceholder="Search problem..." [notificationCount]="notificationCount"
            [isDropdownActive]="isDropdownActive" (searchChange)="onSearchInput($event)"
            (notificationClick)="onNotificationClick()" (dropdownToggle)="toggleDropdown()"
            [searchTerm]="filterForm.value.name || ''"></admin-navbar>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="content-title" style="color: black;"><i class="fa-solid fa-circle-question"></i> Problem
                    Management</h1>
            </div>

            <!-- Loading State -->
            @if (loading) {
            <div class="loading-container">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading problem...</p>
                </div>
            </div>
            }
            @else if (error) {
            <!-- Error State -->
            <div class="error-container">
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>{{ error }}</p>
                    <button class="retry-btn" (click)="loadProblem()">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            </div>
            }
            @else {
            <!-- Main Filter and Table -->
            <form [formGroup]="filterForm" (ngSubmit)="onSubmit($event)" class="filter-form">
                <div class="filter-row">
                    <div class="filter-group levels-group">
                        <label>Độ khó</label>
                        <div class="checkbox-group">
                            <label *ngFor="let level of levelOptions">
                                <input type="checkbox" [value]="level" (change)="onLevelChange($event)"
                                    [checked]="filterForm.value.level?.includes(level)" />
                                {{ level | titlecase }}
                            </label>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label for="sortBy">Sắp xếp theo</label>
                        <select id="sortBy" formControlName="sortBy" class="form-control">
                            <option value="">Mặc định</option>
                            <option value="name">Name</option>
                            <option value="level">Level</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="isDescending">Thứ tự</label>
                        <select id="isDescending" formControlName="isDescending" class="form-control">
                            <option value="">Mặc định</option>
                            <option value="asc">Tăng dần</option>
                            <option value="desc">Giảm dần</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="pageSize">Số câu hỏi trên trang</label>
                        <input type="number" id="pageSize" min="1" [max]="totalElement()" formControlName="pageSize"
                            class="form-control" placeholder="Nhập số" />
                    </div>
                </div>

                <div class="filter-group tags-group">
                    <label>Chủ đề</label>
                    <div class="checkbox-group">
                        <label *ngFor="let tag of (isExpanded() ? listTag() : listTag().slice(0, 5))"
                            class="custom-checkbox-label">
                            <input type="checkbox" class="custom-checkbox" [value]="tag" (change)="onTagChange($event)"
                                [checked]="filterForm.value.tagName?.includes(tag)" />
                            <span class="custom-checkbox-box"></span>
                            {{ tag }}
                        </label>
                    </div>
                    <button type="button" class="expand-btn" (click)="toggleExpand()">
                        {{ isExpanded() ? 'Collapse' : 'Expand' }} <i class="fa-solid"
                            [ngClass]="isExpanded() ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                    </button>
                </div>


                <button type="submit" class="filter-button">Lọc</button>
            </form>

            @if (filteredProblems().length > 0) {
            <button class="add-problem-btn" (click)="onAddProblem()">
                <i class="fas fa-plus"></i> Add Problem
            </button>
            <div class="tags-table">
                <div class="table-header">
                    <div>ID</div>
                    <div>Problem Name</div>
                    <div>Level</div>
                    <div>Status</div>
                    <div>Actions</div>
                </div>

                <div class="table-row">
                    @for (problem of filteredProblems(); track problem.id) {
                    <div>{{ problem.id }}</div>
                    <div>{{ problem.name }}</div>
                    @if(problem.level ==1){
                    <div>Easy</div>
                    }
                    @else if(problem.level ==2){
                    <div>Medium</div>
                    }
                    @else if(problem.level ==3){
                    <div>Hard</div>
                    }

                    <div>
                        <span [class]="getStatusBadgeClass(problem.isDelete)">
                            {{ getStatusText(problem.isDelete) }}
                        </span>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn edit-btn" (click)="onEditProblem(problem)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" (click)="onDeleteProblem(problem)">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button [class]="getColorIconLock(problem.isDelete)" class="action-btn"
                            (click)="onToggleProblemStatus(problem)">
                            <i [class]="getLockIcon(problem.isDelete)"></i>
                        </button>
                    </div>
                    }
                </div>
            </div>
            }
            @else {
            <div class="no-data-row">
                <div class="no-data-message">
                    <i class="fas fa-users-slash"></i>
                    <p>No problem found</p>
                </div>
            </div>
            }

            @if (totalPage() !== 0) {
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <li class="page-item" [class.disabled]="currentPage() === 1">
                        <button class="page-link" (click)="onPageChange(currentPage() - 1)"
                            [disabled]="currentPage() === 1">
                            Previous
                        </button>
                    </li>

                    @for (page of pageNumbers; track page) {
                    <li class="page-item" [class.active]="currentPage() === page">
                        <button class="page-link" (click)="onPageChange(page)">
                            {{ page }}
                        </button>
                    </li>
                    }

                    <li class="page-item" [class.disabled]="currentPage() === totalPage()">
                        <button class="page-link" (click)="onPageChange(currentPage() + 1)"
                            [disabled]="currentPage() === totalPage()">
                            Next
                        </button>
                    </li>
                </ul>
            </nav>
            }
            }
        </div>

        <div class="copyright">©Copyright By CodeGrader 2025</div>
    </div>
</div>